
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>èŒ¶ä¹‹é­”æ‰‹é£²æ–™é»é¤ç³»çµ±</title>
<style>
    /* é é¢æ•´é«”æ¨£å¼ */
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f7f4; color: #2c3e50; }
    h1 { color: #2e7d32; } /* æ¨™é¡Œé¡è‰² */

    /* æŒ‰éˆ•æ¨£å¼ */
    button { padding: 8px 15px; margin: 5px; background-color: #388e3c; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #2e7d32; } /* æ»‘é¼ ç§»ä¸Šå»è®Šæ·±ç¶  */

    /* è¡¨æ ¼æ¨£å¼ */
    table { border-collapse: collapse; margin-top: 10px; width: 100%; background: #fff; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background-color: #c8e6c9; }

    /* è¨‚å–®å¡ç‰‡æ¨£å¼ */
    .card { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 5px; background: #fff; }
    .card h3 { margin: 0; color: #2e7d32; }

    /* åƒ¹æ ¼é¡¯ç¤º */
    #pricePreview { font-weight: bold; color: #e67e22; margin-top: 10px; }

    /* Logo */
    #logo { display: block; margin: 0 auto 20px; width: 200px; }

    /* ç¸½é‡‘é¡é¡¯ç¤º */
    #totalAmount { font-weight: bold; color: #d32f2f; margin-top: 15px; }
</style>
</head>
<body onload="loadMenu()"> <!-- é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥èœå–® -->

  <!-- Logoåœ–ç‰‡ -->
  <img id="logo" src="https://www.teamagichand.com.tw/images/logo2.png" alt="èŒ¶ä¹‹é­”æ‰‹ Logo">

  <!-- ç³»çµ±æ¨™é¡Œ -->
  <h1>ğŸ¹ èŒ¶ä¹‹é­”æ‰‹é£²æ–™é»é¤ç³»çµ±</h1>

  <!-- èœå–®å€å¡Šï¼šJS æœƒè¼‰å…¥èœå–®è¡¨æ ¼ -->
  <h2>èœå–®</h2>
  <div id="menu"></div>

  <!-- æ–°å¢è¨‚å–®è¡¨å–® -->
  <h2>æ–°å¢è¨‚å–®</h2>
  <form id="orderForm">
    é£²æ–™åç¨±: 
    <select id="drinkSelect" name="drink_name"></select><br><br>

    å°ºå¯¸: 
    <select id="sizeSelect" name="size">
      <option value="M">M</option>
      <option value="L">L</option>
    </select><br><br>

    ç³–é‡: 
    <select name="sugar">
      <option>æ­£å¸¸ç³–</option>
      <option>åŠç³–</option>
      <option>å°‘ç³–</option>
      <option>å¾®ç³–</option>
      <option>ç„¡ç³–</option>
    </select><br><br>

    å†°é‡: 
    <select name="ice">
      <option>æ­£å¸¸å†°</option>
      <option>å°‘å†°</option>
      <option>å¾®å†°</option>
      <option>å»å†°</option>
      <option>å¸¸æº«</option>
      <option>ç†±</option>
    </select><br><br>

    åŠ æ–™: 
    <select id="toppingSelect" name="add" multiple>
      <option>çç </option>
      <option>æ³¢éœ¸</option>
      <option>QQ</option>
      <option>æ¤°æœ</option>
      <option>å¯’å¤©</option>
      <option>è—è“å‡</option>
      <option>å¸ƒä¸</option>
    </select><br><br>

    <!-- å³æ™‚è¨ˆç®—åƒ¹æ ¼é¡¯ç¤º -->
    <div id="pricePreview">ç›®å‰ç¸½åƒ¹ï¼š0 å…ƒ</div>

    <!-- é€å‡ºè¨‚å–®æŒ‰éˆ• -->
    <button type="submit">é€å‡ºè¨‚å–®</button>
    <!-- æ¸…é™¤è¡¨å–®æŒ‰éˆ• -->
    <button type="button" onclick="clearForm()">æ¸…é™¤è¡¨å–®</button>
  </form>

  <!-- é¡¯ç¤ºé€å‡ºè¨‚å–®çš„æ”¶æ“š -->
  <div id="orderResult"></div>

  <!-- è¨‚å–®åˆ—è¡¨å€å¡Š -->
  <h2>æ‰€æœ‰è¨‚å–®</h2>
  <div id="orders"></div>

  <!-- ç¸½é‡‘é¡çµ±è¨ˆ -->
  <div id="totalAmount">ç›®å‰æ‰€æœ‰è¨‚å–®ç¸½é‡‘é¡ï¼š0 å…ƒ</div>
<script>
let menuData = {}; // ç”¨ä¾†å­˜æ”¾å¾å¾Œç«¯æ‹¿åˆ°çš„èœå–®è³‡æ–™

// è¼‰å…¥èœå–®ï¼Œä¸¦æ›´æ–°é£²æ–™ä¸‹æ‹‰é¸å–®
async function loadMenu() {
  const res = await fetch('/menu');       // å‘å¾Œç«¯è«‹æ±‚èœå–®è³‡æ–™
  menuData = await res.json();            

  let html = '';                          // ç”¨ä¾†çµ„åˆèœå–®è¡¨æ ¼çš„ HTML
  let drinkOptions = '';                  // ç”¨ä¾†çµ„åˆä¸‹æ‹‰é¸å–®çš„é¸é …

  // è¿´åœˆè·‘æ¯å€‹åˆ†é¡
  for (const category in menuData) {
    // æ¯å€‹åˆ†é¡å…ˆåŠ ä¸Šæ¨™é¡Œå’Œè¡¨æ ¼è¡¨é ­
    html += `<h3>${category}</h3><table><tr><th>é£²æ–™</th><th>M</th><th>L</th></tr>`;
    
    // å†è·‘åˆ†é¡è£¡çš„æ¯å€‹é£²æ–™
    for (const drink in menuData[category]) {
      const prices = menuData[category][drink]; // å–å¾— M/L åƒ¹æ ¼
      // æŠŠé£²æ–™å’Œåƒ¹æ ¼åŠ åˆ°è¡¨æ ¼
      html += `<tr><td>${drink}</td><td>${prices.M}</td><td>${prices.L}</td></tr>`;
      // æŠŠé£²æ–™åç¨±åŠ åˆ°ä¸‹æ‹‰é¸å–®
      drinkOptions += `<option>${drink}</option>`;
    }
    html += '</table>'; // çµæŸé€™å€‹åˆ†é¡çš„è¡¨æ ¼
  }

  // æŠŠçµ„å¥½çš„ HTML æ”¾åˆ°èœå–®å€å¡Š
  document.getElementById('menu').innerHTML = html;
  // æŠŠé£²æ–™é¸é …æ”¾åˆ°ä¸‹æ‹‰é¸å–®
  document.getElementById('drinkSelect').innerHTML = drinkOptions;
  // é è¨­é¸ç¬¬ä¸€å€‹é£²æ–™
  document.getElementById('drinkSelect').selectedIndex = 0;
  // æ›´æ–°å³æ™‚åƒ¹æ ¼é¡¯ç¤º
  updatePricePreview();
}

// å³æ™‚è¨ˆç®—åƒ¹æ ¼
function updatePricePreview() {
  const drink = document.getElementById('drinkSelect').value; // å–å¾—é¸åˆ°çš„é£²æ–™
  const size = document.getElementById('sizeSelect').value;   // å–å¾—é¸åˆ°çš„å°ºå¯¸
  let basePrice = 0;

  // å¾ menuData æ‰¾å‡ºè©²é£²æ–™çš„åŸºæœ¬åƒ¹æ ¼
  for (const category in menuData) {
    if (menuData[category][drink]) {
      basePrice = menuData[category][drink][size];
      break;
    }
  }

  // è¨ˆç®—åŠ æ–™ï¼Œæ¯æ¨£åŠ æ–™ +10 å…ƒ
  const toppings = Array.from(document.getElementById('toppingSelect').selectedOptions).map(o => o.value);
  const total = (basePrice || 0) + toppings.length * 10;

  // æ›´æ–°é é¢ä¸Šçš„åƒ¹æ ¼é¡¯ç¤º
  document.getElementById('pricePreview').innerText = `ç›®å‰ç¸½åƒ¹ï¼š${total} å…ƒ`;
}

// ç•¶é£²æ–™ã€å°ºå¯¸ã€åŠ æ–™æ”¹è®Šæ™‚ï¼Œé‡æ–°è¨ˆç®—åƒ¹æ ¼
document.getElementById('drinkSelect').addEventListener('change', updatePricePreview);
document.getElementById('sizeSelect').addEventListener('change', updatePricePreview);
document.getElementById('toppingSelect').addEventListener('change', updatePricePreview);

// è¡¨å–®é€å‡ºäº‹ä»¶ï¼šæ–°å¢è¨‚å–®
document.getElementById('orderForm').addEventListener('submit', async (e) => {
  e.preventDefault(); // é˜»æ­¢è¡¨å–®é è¨­è¡Œç‚ºï¼ˆé¿å…é é¢åˆ·æ–°ï¼‰

  // æ”¶é›†è¡¨å–®è³‡æ–™
  const fd = new FormData(e.target);
  const payload = {
    drink_name: fd.get('drink_name'),
    size: fd.get('size'),
    sugar: fd.get('sugar'),
    ice: fd.get('ice'),
    add: fd.getAll('add')
  };

  // å‘¼å«å¾Œç«¯ API æ–°å¢è¨‚å–®
  const res = await fetch('/order', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  const data = await res.json();

  // é¡¯ç¤ºè¨‚å–®æ”¶æ“š
  document.getElementById('orderResult').innerHTML = `
    <div class="card">
      <h3>è¨‚å–® #${data.id}</h3>
      <p>é£²æ–™ï¼š${data.drink_name} (${data.size})</p>
      <p>ç³–é‡ï¼š${data.sugar}ã€å†°é‡ï¼š${data.ice}</p>
      <p>åŠ æ–™ï¼š${data.add.join(', ') || 'ç„¡'}</p>
      <strong>ç¸½åƒ¹ï¼š${data.total_price} å…ƒ</strong>
    </div>
  `;

  clearForm();    // æ¸…é™¤è¡¨å–®
  loadOrders();   // æ›´æ–°è¨‚å–®åˆ—è¡¨
});

// æ¸…é™¤è¡¨å–®
function clearForm() {
  document.getElementById('orderForm').reset(); // é‡ç½®è¡¨å–®
  document.getElementById('pricePreview').innerText = "ç›®å‰ç¸½åƒ¹ï¼š0 å…ƒ"; // é‡ç½®åƒ¹æ ¼é¡¯ç¤º
}

// è¼‰å…¥æ‰€æœ‰è¨‚å–®ä¸¦é¡¯ç¤ºç¸½é‡‘é¡
async function loadOrders() {
  const res = await fetch('/orders'); // å‘¼å«å¾Œç«¯ API å–å¾—æ‰€æœ‰è¨‚å–®
  const data = await res.json();
  let html = '';
  let totalAmount = 0;

  // æŠŠæ¯ç­†è¨‚å–®é¡¯ç¤ºæˆå¡ç‰‡
  data.forEach(o => {
    totalAmount += o.total_price;
    html += `
      <div class="card">
        <h3>è¨‚å–® #${o.id}</h3>
        <p>é£²æ–™ï¼š${o.drink_name} (${o.size})</p>
        <p>ç³–é‡ï¼š${o.sugar}ã€å†°é‡ï¼š${o.ice}</p>
        <p>åŠ æ–™ï¼š${o.add.join(', ') || 'ç„¡'}</p>
        <strong>ç¸½åƒ¹ï¼š${o.total_price} å…ƒ</strong>
      </div>
    `;
  });

  // æ›´æ–°è¨‚å–®åˆ—è¡¨å’Œç¸½é‡‘é¡
  document.getElementById('orders').innerHTML = html;
  document.getElementById('totalAmount').innerText = `ç›®å‰æ‰€æœ‰è¨‚å–®ç¸½é‡‘é¡ï¼š${totalAmount} å…ƒ`;
}
</script>
</body>
</html>